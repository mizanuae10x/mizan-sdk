<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>UAE Compliance - Mizan Studio</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="mobile.css">
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Inter',sans-serif;background:#060C18;color:#fff;display:flex;min-height:100vh}
.sidebar{width:240px;background:#0B1F3A;padding:24px 0;display:flex;flex-direction:column;position:fixed;height:100vh;z-index:10}
.sidebar .logo{padding:0 24px 24px;font-size:22px;font-weight:700;color:#D4AF37;border-bottom:1px solid rgba(212,175,55,.2)}
.sidebar nav{flex:1;padding:16px 0}
.sidebar nav a{display:flex;align-items:center;gap:10px;padding:12px 24px;color:rgba(255,255,255,.7);text-decoration:none;font-size:14px;transition:all .2s}
.sidebar nav a:hover,.sidebar nav a.active{color:#D4AF37;background:rgba(212,175,55,.08)}
.sidebar nav a.active{border-right:3px solid #D4AF37}
.sidebar .version{padding:16px 24px;font-size:12px;color:rgba(255,255,255,.3);border-top:1px solid rgba(212,175,55,.1)}
.main{margin-left:240px;flex:1;padding:40px;max-width:1300px}
.hamburger{display:none;position:fixed;top:16px;left:16px;z-index:20;background:#0B1F3A;border:1px solid rgba(212,175,55,.3);color:#D4AF37;font-size:24px;padding:8px 12px;border-radius:8px;cursor:pointer}
.overlay{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.6);z-index:9}
h1{font-size:32px;margin-bottom:8px}
.subtitle{color:rgba(255,255,255,.5);margin-bottom:24px;font-size:14px}
.stats-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:20px;margin-bottom:24px}
.stat-card{background:rgba(11,31,58,.8);border:1px solid rgba(212,175,55,.15);border-radius:12px;padding:22px}
.stat-card h3{font-size:18px;margin-bottom:8px;color:#D4AF37}
.stat-card p{font-size:13px;color:rgba(255,255,255,.55);margin-bottom:10px}
.badge-active{display:inline-flex;align-items:center;gap:6px;padding:4px 10px;background:rgba(52,211,153,.12);color:#34d399;border-radius:999px;font-size:11px;font-weight:600;margin-bottom:10px}
.badge-active .dot{width:8px;height:8px;border-radius:50%;background:#34d399}
.stat-meta{font-size:12px;color:rgba(255,255,255,.45);margin-bottom:8px}
.stat-card a{font-size:12px;color:#D4AF37;text-decoration:none}
.panel{background:rgba(11,31,58,.65);border:1px solid rgba(212,175,55,.15);border-radius:14px;padding:22px;margin-bottom:24px}
.panel h2{font-size:20px;color:#D4AF37;margin-bottom:8px}
.panel-subtitle{font-size:13px;color:rgba(255,255,255,.45);margin-bottom:16px}
label{display:block;font-size:13px;color:rgba(255,255,255,.65);margin-bottom:6px}
textarea{width:100%;padding:14px;background:rgba(255,255,255,.05);border:1px solid rgba(212,175,55,.2);border-radius:8px;color:#fff;font-family:'Courier New',monospace;font-size:13px;resize:vertical;min-height:120px;margin-bottom:14px}
textarea:focus{outline:none;border-color:#D4AF37}
.row{display:flex;gap:18px;flex-wrap:wrap;margin-bottom:14px}
.option-group{background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.08);border-radius:10px;padding:12px 14px;min-width:240px;flex:1}
.option-group .title{font-size:12px;text-transform:uppercase;letter-spacing:.04em;color:rgba(255,255,255,.45);margin-bottom:8px}
.checks{display:flex;gap:12px;flex-wrap:wrap}
.checks label{display:flex;align-items:center;gap:8px;margin:0;font-size:13px;color:rgba(255,255,255,.85);cursor:pointer}
.checks input{accent-color:#D4AF37}
.toggle{display:flex;gap:8px;flex-wrap:wrap}
.toggle button{padding:8px 12px;border-radius:8px;border:1px solid rgba(212,175,55,.3);background:transparent;color:#D4AF37;cursor:pointer;font-size:12px}
.toggle button.active{background:rgba(212,175,55,.18)}
.btn{display:inline-block;padding:11px 24px;background:#D4AF37;color:#0B1F3A;font-weight:600;border-radius:8px;text-decoration:none;font-size:14px;border:none;cursor:pointer;transition:all .2s}
.btn:hover{background:#c9a430}
.spinner{display:none;width:32px;height:32px;border:3px solid rgba(212,175,55,.2);border-top-color:#D4AF37;border-radius:50%;animation:spin .8s linear infinite;margin:16px auto}
.spinner.show{display:block}
@keyframes spin{to{transform:rotate(360deg)}}
.results{display:none;opacity:0;transform:translateY(8px)}
.results.show{display:block;animation:fadeIn .35s ease forwards}
@keyframes fadeIn{to{opacity:1;transform:translateY(0)}}
.score-wrap{display:flex;justify-content:center;align-items:center;flex-direction:column;padding:18px 0 24px}
.score{font-size:72px;font-weight:700;line-height:1}
.score.good{color:#34d399}
.score.warn{color:#fbbf24}
.score.bad{color:#ef4444}
.status-badge{margin-top:8px;padding:5px 12px;border-radius:999px;font-size:12px;font-weight:600}
.status-compliant{background:rgba(52,211,153,.15);color:#34d399}
.status-review{background:rgba(251,191,36,.15);color:#fbbf24}
.status-non{background:rgba(239,68,68,.15);color:#ef4444}
.summary{font-size:14px;color:rgba(255,255,255,.75);margin-bottom:8px}
.summary-ar{direction:rtl;text-align:right;font-size:12px;color:rgba(255,255,255,.4);margin-bottom:12px}
.check-list{display:grid;gap:12px}
.check-card{background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.08);border-radius:10px;padding:14px}
.check-card.pdpl{border-left:3px solid #3b82f6}
.check-card.uae_ai_ethics{border-left:3px solid #a855f7}
.check-card.nesa{border-left:3px solid #f97316}
.check-top{display:flex;justify-content:space-between;gap:8px;flex-wrap:wrap;margin-bottom:8px}
.fw-pill{padding:4px 10px;border-radius:999px;font-size:11px;font-weight:600}
.fw-pdpl{background:rgba(59,130,246,.15);color:#60a5fa}
.fw-ethics{background:rgba(168,85,247,.15);color:#c084fc}
.fw-nesa{background:rgba(249,115,22,.15);color:#fb923c}
.check-status{font-size:12px;font-weight:600}
.st-pass{color:#34d399}
.st-fail{color:#ef4444}
.st-review{color:#fbbf24}
.check-title{font-size:14px;color:#fff;margin-bottom:6px}
.check-detail{font-size:12px;color:rgba(255,255,255,.6);margin-bottom:6px}
.remediation{font-size:12px;color:#fb923c;margin-bottom:4px}
.remediation-strong{color:#ef4444}
.ar{direction:rtl;text-align:right;font-size:12px;color:rgba(255,255,255,.4)}
.pii-results{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
.pii-badge{padding:8px 12px;border-radius:999px;font-size:12px;font-weight:600;border:1px solid transparent}
.pii-clean{background:rgba(52,211,153,.12);color:#34d399;border-color:rgba(52,211,153,.28)}
.footer{text-align:center;padding:24px 0 8px;font-size:12px;color:rgba(255,255,255,.25)}
</style>
</head>
<body>
<div class="hamburger" onclick="toggleSidebar()">‚ò∞</div>
<div class="overlay" id="overlay" onclick="toggleSidebar()"></div>
<div class="sidebar" id="sidebar">
  <div class="logo">‚öñÔ∏è Mizan Studio</div>
  <nav>
    <a href="index.html">üè† Home</a>
    <a href="rules.html">üìã Rule Editor</a>
    <a href="decide.html">‚ö° Decision Tester</a>
    <a href="audit.html">üìä Audit Log</a>
    <a href="agents.html">ü§ñ Agent Monitor</a>
    <a href="compliance.html" class="active"><span>üá¶üá™</span> UAE Compliance</a>
    <a href="rag.html"><span>üìö</span> Knowledge Base</a>
    <a href="widget-demo.html"><span>üîå</span> Widget Demo</a>
    <a href="setup.html">‚öôÔ∏è Setup</a>
  </nav>
  <div class="version">üì¶ v1.1.0</div>
</div>
<div class="main">
  <h1>üá¶üá™ UAE Compliance</h1>
  <p class="subtitle">PDPL, AI Ethics, and NESA compliance scanning with bilingual reporting</p>

  <section class="stats-grid">
    <article class="stat-card">
      <h3>üîí PDPL</h3>
      <p>Federal Decree-Law No. 45/2021 personal data obligations</p>
      <div class="badge-active"><span class="dot"></span> ACTIVE</div>
      <div class="stat-meta">14 Articles covered</div>
      <a href="https://u.ae/en/information-and-services/justice-safety-and-the-law/consumer-protection/personal-data-protection" target="_blank" rel="noopener">Learn More ‚Üó</a>
    </article>
    <article class="stat-card">
      <h3>üß† UAE AI Ethics</h3>
      <p>UAE AI Office principles for responsible AI systems</p>
      <div class="badge-active"><span class="dot"></span> ACTIVE</div>
      <div class="stat-meta">6 Principles</div>
      <a href="https://ai.gov.ae/" target="_blank" rel="noopener">Learn More ‚Üó</a>
    </article>
    <article class="stat-card">
      <h3>üõ°Ô∏è NESA</h3>
      <p>National Electronic Security Authority cybersecurity controls</p>
      <div class="badge-active"><span class="dot"></span> ACTIVE</div>
      <div class="stat-meta">4 Controls</div>
      <a href="https://u.ae/en/about-the-uae/digital-uae/cyber-safety-and-digital-security" target="_blank" rel="noopener">Learn More ‚Üó</a>
    </article>
  </section>

  <section class="panel">
    <h2>Section B - Compliance Scanner</h2>
    <p class="panel-subtitle">Submit input payloads and run checks across selected UAE frameworks.</p>

    <label for="inputJson">Input JSON</label>
    <textarea id="inputJson" placeholder='{"userId": "U123", "action": "loan_application", "amount": 50000}'>{"userId":"U123","action":"loan_application","amount":50000}</textarea>

    <div class="row">
      <div class="option-group">
        <div class="title">Frameworks</div>
        <div class="checks">
          <label><input type="checkbox" value="PDPL" checked> PDPL</label>
          <label><input type="checkbox" value="UAE_AI_ETHICS" checked> UAE AI Ethics</label>
          <label><input type="checkbox" value="NESA" checked> NESA</label>
        </div>
      </div>
      <div class="option-group">
        <div class="title">Language</div>
        <div class="toggle">
          <button type="button" data-lang="en">English</button>
          <button type="button" data-lang="ar">Arabic</button>
          <button type="button" data-lang="both" class="active">Both</button>
        </div>
      </div>
    </div>

    <button class="btn" id="runBtn">Run Compliance Check</button>
    <div class="spinner" id="scanSpinner"></div>

    <div class="results" id="scanResults">
      <div class="score-wrap">
        <div class="score" id="scoreValue">0</div>
        <div class="status-badge" id="statusBadge">-</div>
      </div>
      <p class="summary" id="summaryEn"></p>
      <p class="summary-ar" id="summaryAr"></p>
    </div>
  </section>

  <section class="panel">
    <h2>Section C - Checks Breakdown</h2>
    <p class="panel-subtitle">Detailed status by framework article/principle with remediation guidance.</p>
    <div class="check-list" id="checksList">
      <div class="check-card">
        <div class="check-detail">Run a scan to see framework checks.</div>
      </div>
    </div>
  </section>

  <section class="panel">
    <h2>Section D - PII Detector</h2>
    <p class="panel-subtitle">Paste free text and detect UAE personal identifiers before processing.</p>
    <label for="piiText">Text Input</label>
    <textarea id="piiText" placeholder="Paste text to scan for Emirates ID, UAE phone, email, passport number..."></textarea>
    <button class="btn" id="piiBtn">Scan for PII</button>
    <div class="spinner" id="piiSpinner"></div>
    <div class="pii-results" id="piiResults"></div>
  </section>

  <div class="footer">‚öñÔ∏è Mizan Framework SDK v1.1.0 | Built by mizanuae10x</div>
</div>
<script>
function toggleSidebar(){document.getElementById('sidebar').classList.toggle('open');document.getElementById('overlay').classList.toggle('show')}

let selectedLanguage='both';
document.querySelectorAll('.toggle button').forEach(btn=>{
  btn.addEventListener('click',()=>{
    selectedLanguage=btn.dataset.lang;
    document.querySelectorAll('.toggle button').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
  });
});

function frameworkClass(framework){
  if(framework==='PDPL') return 'pdpl';
  if(framework==='UAE_AI_ETHICS') return 'uae_ai_ethics';
  return 'nesa';
}

function frameworkPill(framework){
  if(framework==='PDPL') return '<span class="fw-pill fw-pdpl">PDPL</span>';
  if(framework==='UAE_AI_ETHICS') return '<span class="fw-pill fw-ethics">UAE_AI_ETHICS</span>';
  return '<span class="fw-pill fw-nesa">NESA</span>';
}

function statusLabel(check){
  if(check.status==='NON_COMPLIANT') return '<span class="check-status st-fail">‚ùå FAILED</span>';
  if(check.status==='REVIEW_REQUIRED') return '<span class="check-status st-review">‚ö†Ô∏è REVIEW</span>';
  return '<span class="check-status st-pass">‚úÖ PASSED</span>';
}

function renderChecks(checks){
  const el=document.getElementById('checksList');
  if(!checks.length){
    el.innerHTML='<div class="check-card"><div class="check-detail">No checks returned.</div></div>';
    return;
  }
  el.innerHTML=checks.map(check=>{
    const remediationClass=check.status==='NON_COMPLIANT'?'remediation remediation-strong':'remediation';
    return `<div class="check-card ${frameworkClass(check.framework)}">
      <div class="check-top">
        <div>${frameworkPill(check.framework)}</div>
        <div class="check-detail">${check.article}</div>
        <div>${statusLabel(check)}</div>
      </div>
      <div class="check-title">${check.requirement}</div>
      <div class="check-detail">${check.details || ''}</div>
      ${check.remediation?`<div class="${remediationClass}">${check.remediation}</div>`:''}
      ${check.remediationAr?`<div class="ar">${check.remediationAr}</div>`:''}
      <div class="ar">${check.requirementAr || ''}</div>
    </div>`;
  }).join('');
}

function renderReport(report){
  const scoreEl=document.getElementById('scoreValue');
  const badgeEl=document.getElementById('statusBadge');
  scoreEl.textContent=report.score;
  scoreEl.className='score '+(report.score>80?'good':report.score>=60?'warn':'bad');

  const status=report.overallStatus;
  badgeEl.textContent=status;
  badgeEl.className='status-badge '+(status==='COMPLIANT'?'status-compliant':status==='REVIEW_REQUIRED'?'status-review':'status-non');

  document.getElementById('summaryEn').textContent=report.summary || '';
  document.getElementById('summaryAr').textContent=report.summaryAr || '';
  document.getElementById('scanResults').classList.add('show');
  renderChecks(report.checks || []);
}

async function runScan(){
  const spinner=document.getElementById('scanSpinner');
  const results=document.getElementById('scanResults');
  const btn=document.getElementById('runBtn');
  let input={};

  try{input=JSON.parse(document.getElementById('inputJson').value || '{}')}
  catch(e){alert('Invalid JSON input: '+e.message);return}

  const frameworks=[...document.querySelectorAll('input[type=checkbox]:checked')].map(c=>c.value);
  spinner.classList.add('show');
  results.classList.remove('show');
  btn.disabled=true;

  try{
    const response=await fetch('/api/compliance/check',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({input,frameworks,language:selectedLanguage})
    });
    const report=await response.json();
    if(!response.ok) throw new Error(report.error || 'Compliance API error');
    renderReport(report);
  }catch(e){
    alert('Compliance check failed: '+e.message);
  }finally{
    spinner.classList.remove('show');
    btn.disabled=false;
  }
}

function piiBadge(text,color){
  return `<span class="pii-badge" style="background:${color}1f;color:${color};border-color:${color}66">${text}</span>`;
}

async function scanPii(){
  const text=document.getElementById('piiText').value || '';
  const spinner=document.getElementById('piiSpinner');
  const btn=document.getElementById('piiBtn');
  const out=document.getElementById('piiResults');

  spinner.classList.add('show');
  out.innerHTML='';
  btn.disabled=true;

  try{
    const response=await fetch('/api/compliance/pii',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({text})
    });
    const data=await response.json();
    if(!response.ok) throw new Error(data.error || 'PII API error');

    if(data.clean){
      out.innerHTML='<span class="pii-badge pii-clean">üü¢ No PII detected</span>';
      return;
    }

    out.innerHTML=(data.findings || []).map(f=>{
      if(f.type==='Emirates ID') return piiBadge('üî¥ Emirates ID detected', f.color || '#ef4444');
      if(f.type==='UAE Phone (+971)') return piiBadge('üü† UAE Phone (+971) detected', f.color || '#f97316');
      if(f.type==='Email Address') return piiBadge('üü° Email detected', f.color || '#eab308');
      return piiBadge(`üî¥ ${f.type} detected`, f.color || '#ef4444');
    }).join('');
  }catch(e){
    out.innerHTML='<span class="pii-badge" style="background:rgba(239,68,68,.12);color:#ef4444;border-color:rgba(239,68,68,.3)">Scan failed</span>';
  }finally{
    spinner.classList.remove('show');
    btn.disabled=false;
  }
}

document.getElementById('runBtn').addEventListener('click',runScan);
document.getElementById('piiBtn').addEventListener('click',scanPii);
</script>
</body>
</html>
