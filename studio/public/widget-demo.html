<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Widget Demo - Mizan Studio</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="mobile.css">
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Inter',sans-serif;background:#060C18;color:#fff;display:flex;min-height:100vh}
.sidebar{width:240px;background:#0B1F3A;padding:24px 0;display:flex;flex-direction:column;position:fixed;height:100vh;z-index:10}
.sidebar .logo{padding:0 24px 24px;font-size:22px;font-weight:700;color:#D4AF37;border-bottom:1px solid rgba(212,175,55,.2)}
.sidebar nav{flex:1;padding:16px 0}
.sidebar nav a{display:flex;align-items:center;gap:10px;padding:12px 24px;color:rgba(255,255,255,.7);text-decoration:none;font-size:14px;transition:all .2s}
.sidebar nav a:hover,.sidebar nav a.active{color:#D4AF37;background:rgba(212,175,55,.08)}
.sidebar nav a.active{border-right:3px solid #D4AF37}
.sidebar .version{padding:16px 24px;font-size:12px;color:rgba(255,255,255,.3);border-top:1px solid rgba(212,175,55,.1)}
.main{margin-left:240px;flex:1;padding:36px}
.hamburger{display:none;position:fixed;top:16px;left:16px;z-index:20;background:#0B1F3A;border:1px solid rgba(212,175,55,.3);color:#D4AF37;font-size:24px;padding:8px 12px;border-radius:8px;cursor:pointer}
.overlay{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.6);z-index:9}
h1{font-size:28px;margin-bottom:10px}
.subtitle{font-size:14px;color:rgba(255,255,255,.58);margin-bottom:24px}
.panel{background:rgba(11,31,58,.75);border:1px solid rgba(212,175,55,.2);border-radius:14px;padding:20px;margin-bottom:16px}
.panel h2{font-size:18px;color:#D4AF37;margin-bottom:10px}
.panel p{font-size:14px;color:rgba(255,255,255,.74);line-height:1.55}
.code{background:rgba(0,0,0,.42);border:1px solid rgba(212,175,55,.15);border-radius:10px;padding:12px;margin-top:10px;overflow:auto}
.code pre{font-family:'Courier New',monospace;font-size:12px;line-height:1.5;color:#d7b85d}
.btn{padding:10px 14px;border-radius:8px;border:none;background:#D4AF37;color:#0B1F3A;font-weight:600;cursor:pointer}
.small{font-size:12px;color:rgba(255,255,255,.55);margin-top:6px}
</style>
</head>
<body>
<script>
(function(){
  var t=localStorage.getItem("mizanStudioToken");
  if(!t){window.location.href="/login.html";return;}
  fetch("/api/auth/me",{headers:{"Authorization":"Bearer "+t}})
    .then(function(r){if(r.status===401){localStorage.removeItem("mizanStudioToken");window.location.href="/login.html";}})
    .catch(function(){});
})();
</script>

<div class="hamburger" onclick="toggleSidebar()">‚ò∞</div>
<div class="overlay" id="overlay" onclick="toggleSidebar()"></div>
<div class="sidebar" id="sidebar">
  <div class="logo">‚öñÔ∏è Mizan Studio</div>
  <nav>
    <a href="index.html">üè† Home</a>
    <a href="rules.html">üìã Rule Editor</a>
    <a href="decide.html">‚ö° Decision Tester</a>
    <a href="audit.html">üìä Audit Log</a>
    <a href="agents.html">ü§ñ Agent Builder</a>
    <a href="compliance.html"><span>üá¶üá™</span> UAE Compliance</a>
    <a href="rag.html"><span>üìö</span> Knowledge Base</a>
    <a href="widget-demo.html" class="active"><span>üîå</span> Widget Demo</a>
    <a href="webhooks.html"><span>üîó</span> Webhooks</a>
    <a href="orchestration.html"><span>üîÄ</span> Multi-Agent</a>
    <a href="setup.html">‚öôÔ∏è Setup</a>
  <div style="position:absolute;bottom:20px;left:0;right:0;padding:0 12px;z-index:10;">
  <div style="background:#060C18;border:1px solid rgba(212,175,55,0.12);border-radius:10px;padding:12px;font-size:13px;text-align:center;">
    <div id="nav-user-name" style="color:#D4AF37;font-weight:600;margin-bottom:2px;font-size:13px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">ŸÖŸäÿ≤ÿßŸÜ</div>
    <div id="nav-user-email" style="font-size:11px;color:#475569;margin-bottom:8px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;"></div>
    <button id="nav-logout-btn" style="background:#D4AF37;color:#060C18;border:none;border-radius:6px;padding:5px 0;cursor:pointer;font-size:12px;font-weight:700;width:100%;font-family:inherit;">ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨</button>
  </div>
</div>
<script>
(function(){
  var t=localStorage.getItem("mizanStudioToken");
  if(!t)return;
  fetch("/api/auth/me",{headers:{"Authorization":"Bearer "+t}})
    .then(function(r){return r.json();})
    .then(function(d){
      if(d.user){
        var n=document.getElementById("nav-user-name");
        var e=document.getElementById("nav-user-email");
        if(n)n.textContent=d.user.name||"Admin";
        if(e)e.textContent=d.user.email||"";
      }
    }).catch(function(){});
  var btn=document.getElementById("nav-logout-btn");
  if(btn)btn.onclick=function(){
    var tok=localStorage.getItem("mizanStudioToken")||"";
    localStorage.removeItem("mizanStudioToken");
    fetch("/api/auth/logout",{method:"POST",headers:{"Authorization":"Bearer "+tok}});
    window.location.href="/login.html";
  };
})();
</script>
</nav>
  <div class="version">üì¶ v1.1.0</div>
</div>

<div class="main">
  <h1>üîå Widget Demo</h1>
  <p class="subtitle">Copy one line of HTML and embed your Mizan agent chat in any website.</p>

  <div class="panel">
    <h2>1. Embed Instructions</h2>
    <p>Add this script in your HTML before the closing <code>&lt;/body&gt;</code>. Replace the agent and key values.</p>
    <div class="code"><pre id="embedCode">&lt;script src="https://your-domain.com/widget.js" data-agent="AGENT_ID" data-key="mzn_k_..." data-theme="navy" data-lang="en"&gt;&lt;/script&gt;</pre></div>
    <button class="btn" onclick="copyEmbed()">Copy HTML</button>
    <div class="small" id="copyStatus"></div>
  </div>

  <div class="panel">
    <h2>2. Live Preview</h2>
    <p>The widget script is embedded on this page. If no agents exist, it will run in demo mode and still load.</p>
    <div class="small" id="previewStatus">Loading agent for preview...</div>
  </div>
</div>

<script>
function toggleSidebar(){document.getElementById('sidebar').classList.toggle('open');document.getElementById('overlay').classList.toggle('show')}

function copyEmbed(){
  const code=document.getElementById('embedCode').textContent;
  navigator.clipboard.writeText(code);
  document.getElementById('copyStatus').textContent='Copied to clipboard';
  setTimeout(function(){document.getElementById('copyStatus').textContent='';},2200);
}

(async function init(){
  let agentId='demo-agent';
  try{
    const agents=await (await fetch('/api/agents')).json();
    if(Array.isArray(agents)&&agents.length){
      agentId=agents[0].id;
      document.getElementById('previewStatus').textContent='Using agent: '+(agents[0].name||agents[0].id)+' ('+agentId+')';
    }else{
      document.getElementById('previewStatus').textContent='No agents found. Widget is loaded in demo mode.';
    }
  }catch(e){
    document.getElementById('previewStatus').textContent='Could not load agents. Widget is loaded in demo mode.';
  }

  document.getElementById('embedCode').textContent='<script src="'+location.origin+'/widget.js" data-agent="'+agentId+'" data-key="mzn_k_..." data-theme="navy" data-lang="en"></script>';

  const s=document.createElement('script');
  s.src='/widget.js';
  s.setAttribute('data-agent',agentId);
  s.setAttribute('data-theme','navy');
  s.setAttribute('data-lang','en');
  document.body.appendChild(s);
})();
</script>
</body>
</html>
