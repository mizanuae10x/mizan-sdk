<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Rule Editor ‚Äî Mizan Studio</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="mobile.css">
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Inter',sans-serif;background:#060C18;color:#fff;display:flex;min-height:100vh}
.sidebar{width:240px;background:#0B1F3A;padding:24px 0;display:flex;flex-direction:column;position:fixed;height:100vh;z-index:10}
.sidebar .logo{padding:0 24px 24px;font-size:22px;font-weight:700;color:#D4AF37;border-bottom:1px solid rgba(212,175,55,.2)}
.sidebar nav{flex:1;padding:16px 0}
.sidebar nav a{display:flex;align-items:center;gap:10px;padding:12px 24px;color:rgba(255,255,255,.7);text-decoration:none;font-size:14px;transition:all .2s}
.sidebar nav a:hover,.sidebar nav a.active{color:#D4AF37;background:rgba(212,175,55,.08)}
.sidebar nav a.active{border-right:3px solid #D4AF37}
.sidebar .version{padding:16px 24px;font-size:12px;color:rgba(255,255,255,.3);border-top:1px solid rgba(212,175,55,.1)}
.main{margin-left:240px;flex:1;padding:40px}
.hamburger{display:none;position:fixed;top:16px;left:16px;z-index:20;background:#0B1F3A;border:1px solid rgba(212,175,55,.3);color:#D4AF37;font-size:24px;padding:8px 12px;border-radius:8px;cursor:pointer}
.overlay{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.6);z-index:9}
h1{font-size:28px;margin-bottom:8px}
.subtitle{color:rgba(255,255,255,.5);margin-bottom:24px;font-size:14px}
.toolbar{display:flex;gap:12px;margin-bottom:24px;flex-wrap:wrap}
.btn{padding:10px 24px;background:#D4AF37;color:#0B1F3A;font-weight:600;border-radius:8px;border:none;cursor:pointer;font-size:14px;transition:all .2s}
.btn:hover{background:#c9a430}
.btn-outline{background:transparent;border:1px solid rgba(212,175,55,.4);color:#D4AF37}
.btn-outline:hover{background:rgba(212,175,55,.1)}
.btn-red{background:transparent;border:1px solid rgba(239,68,68,.4);color:#ef4444}
.btn-red:hover{background:rgba(239,68,68,.1)}
table{width:100%;border-collapse:collapse;margin-bottom:24px}
th{text-align:left;padding:12px 16px;font-size:12px;text-transform:uppercase;color:rgba(255,255,255,.4);border-bottom:1px solid rgba(212,175,55,.1)}
td{padding:12px 16px;border-bottom:1px solid rgba(255,255,255,.05);font-size:14px}
tr:hover{background:rgba(212,175,55,.03)}
.badge{padding:4px 10px;border-radius:6px;font-size:12px;font-weight:600}
.badge-approved{background:rgba(52,211,153,.15);color:#34d399}
.badge-rejected{background:rgba(239,68,68,.15);color:#ef4444}
.badge-review{background:rgba(251,191,36,.15);color:#fbbf24}
.toggle{width:40px;height:22px;background:rgba(255,255,255,.15);border-radius:11px;position:relative;cursor:pointer;transition:all .2s}
.toggle.on{background:rgba(52,211,153,.4)}
.toggle .knob{width:18px;height:18px;background:#fff;border-radius:50%;position:absolute;top:2px;left:2px;transition:all .2s}
.toggle.on .knob{left:20px}
.modal-bg{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.7);z-index:100;justify-content:center;align-items:center}
.modal-bg.show{display:flex}
.modal{background:#0B1F3A;border:1px solid rgba(212,175,55,.2);border-radius:16px;padding:32px;width:500px;max-width:95%}
.modal h2{font-size:20px;margin-bottom:20px;color:#D4AF37}
.form-group{margin-bottom:16px}
.form-group label{display:block;font-size:13px;color:rgba(255,255,255,.6);margin-bottom:6px}
.form-group input,.form-group select,.form-group textarea{width:100%;padding:10px 14px;background:rgba(255,255,255,.05);border:1px solid rgba(212,175,55,.2);border-radius:8px;color:#fff;font-size:14px;font-family:inherit}
.form-group input:focus,.form-group select:focus,.form-group textarea:focus{outline:none;border-color:#D4AF37}
.form-group select option{background:#0B1F3A}
.empty{text-align:center;padding:60px 20px;color:rgba(255,255,255,.4)}
.empty .icon{font-size:48px;margin-bottom:12px}
.conflicts{background:rgba(251,191,36,.08);border:1px solid rgba(251,191,36,.2);border-radius:12px;padding:16px;margin-bottom:24px}
.conflicts h3{color:#fbbf24;font-size:14px;margin-bottom:8px}
.conflicts p{font-size:13px;color:rgba(255,255,255,.6)}
.footer{text-align:center;padding:40px;font-size:12px;color:rgba(255,255,255,.25)}
</style>
</head>
<body>
<div class="hamburger" onclick="toggleSidebar()">‚ò∞</div>
<div class="overlay" id="overlay" onclick="toggleSidebar()"></div>
<div class="sidebar" id="sidebar">
  <div class="logo">‚öñÔ∏è Mizan Studio</div>
  <nav>
    <a href="index.html">üè† Home</a>
    <a href="rules.html" class="active">üìã Rule Editor</a>
    <a href="decide.html">‚ö° Decision Tester</a>
    <a href="audit.html">üìä Audit Log</a>
    <a href="agents.html">ü§ñ Agent Monitor</a>
    <a href="compliance.html"><span>üá¶üá™</span> UAE Compliance</a>
    <a href="rag.html"><span>üìö</span> Knowledge Base</a>
    <a href="setup.html">‚öôÔ∏è Setup</a>
  </nav>
  <div class="version">üì¶ v1.1.0</div>
</div>
<div class="main">
  <h1>üìã Rule Editor</h1>
  <p class="subtitle">Create and manage governance rules</p>
  <div class="toolbar">
    <button class="btn" onclick="showModal()">+ Add Rule</button>
    <button class="btn btn-outline" onclick="loadDemo()">üì¶ Load Demo Rules</button>
    <button class="btn btn-red" onclick="clearAll()">üóë Clear All</button>
  </div>
  <div id="conflicts"></div>
  <div id="rulesTable"></div>
  <div class="footer">‚öñÔ∏è Mizan Framework SDK v1.1.0 | Built by mizanuae10x</div>
</div>
<div class="modal-bg" id="modal">
  <div class="modal">
    <h2 id="modalTitle">Add Rule</h2>
    <div class="form-group"><label>Name</label><input id="fName" placeholder="e.g. Budget Threshold"></div>
    <div class="form-group"><label>Condition (JavaScript expression)</label><textarea id="fCondition" rows="2" placeholder="e.g. budget >= 100000"></textarea></div>
    <div class="form-group"><label>Action</label><select id="fAction"><option>APPROVED</option><option>REJECTED</option><option>REVIEW</option></select></div>
    <div class="form-group"><label>Reason</label><input id="fReason" placeholder="Why this action?"></div>
    <div class="form-group"><label>Priority (0-3)</label><input id="fPriority" type="number" value="1" min="0" max="3"></div>
    <div style="display:flex;gap:12px;justify-content:flex-end">
      <button class="btn btn-outline" onclick="hideModal()">Cancel</button>
      <button class="btn" id="saveBtn" onclick="saveRule()">Save Rule</button>
    </div>
  </div>
</div>
<script>
let editingId=null;
function toggleSidebar(){document.getElementById('sidebar').classList.toggle('open');document.getElementById('overlay').classList.toggle('show')}
function showModal(rule){
  editingId=rule?rule.id:null;
  document.getElementById('modalTitle').textContent=rule?'Edit Rule':'Add Rule';
  document.getElementById('fName').value=rule?rule.name:'';
  document.getElementById('fCondition').value=rule?rule.condition:'';
  document.getElementById('fAction').value=rule?rule.action:'APPROVED';
  document.getElementById('fReason').value=rule?rule.reason:'';
  document.getElementById('fPriority').value=rule?rule.priority:1;
  document.getElementById('modal').classList.add('show');
}
function hideModal(){document.getElementById('modal').classList.remove('show');editingId=null}
async function saveRule(){
  const body={name:document.getElementById('fName').value,condition:document.getElementById('fCondition').value,action:document.getElementById('fAction').value,reason:document.getElementById('fReason').value,priority:parseInt(document.getElementById('fPriority').value)||1};
  if(!body.name||!body.condition){alert('Name and condition required');return}
  if(editingId){await fetch('/api/rules/'+editingId,{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify(body)})}
  else{await fetch('/api/rules',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(body)})}
  hideModal();loadRules();
}
async function deleteRule(id){if(confirm('Delete this rule?')){await fetch('/api/rules/'+id,{method:'DELETE'});loadRules()}}
async function toggleRule(id,active){await fetch('/api/rules/'+id,{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify({active:!active})});loadRules()}
async function loadDemo(){await fetch('/api/demo/load',{method:'POST'});loadRules()}
async function clearAll(){if(confirm('Clear all rules?')){const rules=await(await fetch('/api/rules')).json();for(const r of rules)await fetch('/api/rules/'+r.id,{method:'DELETE'});loadRules()}}
async function loadRules(){
  const rules=await(await fetch('/api/rules')).json();
  const conflicts=await(await fetch('/api/conflicts')).json();
  const cd=document.getElementById('conflicts');
  if(conflicts.length){cd.innerHTML='<div class="conflicts"><h3>‚ö†Ô∏è '+conflicts.length+' conflict(s) detected</h3>'+conflicts.map(c=>'<p>'+c.explanation+'</p>').join('')+'</div>'}else{cd.innerHTML=''}
  const el=document.getElementById('rulesTable');
  if(!rules.length){el.innerHTML='<div class="empty"><div class="icon">üìã</div><p>No rules yet. Add your first rule or load demo data.</p></div>';return}
  el.innerHTML='<table><thead><tr><th>Name</th><th>Condition</th><th>Action</th><th>Priority</th><th>Active</th><th>Actions</th></tr></thead><tbody>'+rules.map(r=>{
    const bc=r.action==='APPROVED'?'badge-approved':r.action==='REJECTED'?'badge-rejected':'badge-review';
    return '<tr><td>'+r.name+'</td><td><code>'+r.condition+'</code></td><td><span class="badge '+bc+'">'+r.action+'</span></td><td>'+r.priority+'</td><td><div class="toggle'+(r.active?' on':'')+'" onclick="toggleRule(\''+r.id+'\','+r.active+')"><div class="knob"></div></div></td><td><button class="btn btn-outline" style="padding:6px 12px;font-size:12px" onclick=\'showModal('+JSON.stringify(r).replace(/'/g,"\\'")+')\'">Edit</button> <button class="btn btn-red" style="padding:6px 12px;font-size:12px" onclick="deleteRule(\''+r.id+'\')">Del</button></td></tr>'}).join('')+'</tbody></table>';
}
loadRules();
</script>
</body>
</html>
